/* eslint-disable */
import { debug, Server, MasterServer } from '../src';

debug.enable(__dirname + '/debug.log');

function classifyErrors(results: PromiseSettledResult<unknown>[], servers: string[]): void {
	const errors: Record<string, string[]> = {};
	for(let i = 0; i < results.length; i++){
		const info = results[i]!;

		if(info.status === 'rejected'){
			if(!(info.reason.message in errors)){
				errors[info.reason.message] = [];
			}

			errors[info.reason.message]!.push(servers[i]!);
		}
	}

	for(const err in errors) debug(errors[err]!, err);
}

(async () => {
	let servers = [
		'162.248.93.98:27015',
		'74.91.123.161:27015',
		'108.61.125.162:27015',
		'5.161.98.191:27016',
		'72.5.195.96:27015',
		'74.91.115.181:27015',
		'45.56.88.52:27023',
		'162.248.88.40:6307',
		'74.91.119.28:27018',
		'173.230.153.61:27015',
		'68.232.179.3:27015',
		'74.91.112.103:27015',
		'68.232.178.96:27015',
		'104.128.62.53:27016',
		'204.209.75.253:27018',
		'206.217.202.50:27015',
		'104.153.105.142:27017',
		'108.61.125.70:27015',
		'108.61.238.75:27025',
		'75.152.211.190:27015',
		'204.209.75.253:27022',
		'76.198.155.37:27018',
		'149.28.44.79:27017',
		'104.128.58.147:27015',
		'108.61.100.50:27035',
		'74.91.112.12:27015',
		'74.121.150.54:27015',
		'66.55.149.108:27015',
		'76.109.63.175:27015',
		'66.55.137.165:27015',
		'66.55.142.21:28020',
		'45.76.5.226:27015',
		'68.232.171.209:27015',
		'108.61.88.106:27015',
		'108.61.238.170:27025',
		'45.76.27.15:27015',
		'204.209.75.253:27019',
		'208.167.243.61:27025',
		'70.42.74.194:27058',
		'74.91.116.55:27015',
		'104.128.58.206:27015',
		'24.243.84.222:27015',
		'66.55.154.36:27015',
		'108.61.100.221:27055',
		'63.251.20.98:27015',
		'76.198.155.37:27020',
		'108.61.88.76:27055',
		'108.61.125.76:27025',
		'208.167.235.27:27015',
		'108.69.58.226:27015',
		'107.214.208.253:27015',
		'66.55.158.15:27015',
		'104.128.62.53:27015',
		'108.61.238.122:27025',
		'108.61.100.227:27075',
		'74.91.120.196:27015',
		'108.61.232.127:27035',
		'108.61.125.207:27015',
		'68.232.163.112:27065',
		'173.237.51.117:27015',
		'108.61.88.104:27970',
		'69.30.195.10:27024',
		'158.101.97.192:27015',
		'92.119.148.87:27015',
		'69.58.2.251:27015',
		'108.61.88.76:27035',
		'74.91.119.28:27016',
		'192.223.24.131:27015',
		'45.76.231.190:27015',
		'5.161.142.77:31343',
		'76.198.155.37:27017',
		'104.153.105.67:27015',
		'108.61.121.82:27970',
		'74.91.113.158:27015',
		'74.91.125.78:27015',
		'74.91.115.24:27015',
		'68.131.105.71:27016',
		'108.61.233.85:27025',
		'192.223.30.72:27015',
		'74.91.119.208:27015',
		'162.248.88.24:27015',
		'74.91.119.28:27015',
		'104.153.105.142:27016',
		'108.61.125.207:27990',
		'172.4.195.158:27015',
		'68.131.105.71:27015',
		'104.153.108.43:27015',
		'172.93.48.82:27015',
		'68.232.172.100:27015',
		'216.52.148.31:27015',
		'74.91.119.28:27017',
		'74.91.122.89:27019',
		'74.91.124.227:27022',
		'74.91.115.75:27015',
		'162.248.88.40:6309',
		'76.198.155.37:27019',
		'74.91.115.20:27015',
		'74.91.115.159:27052',
		'149.28.120.27:11111',
		'74.91.124.33:27015',
		'66.42.113.163:27015',
		'216.52.143.40:27015',
		'74.91.122.89:27017',
		'74.91.122.174:27015',
		'108.61.125.118:27015',
		'162.248.94.10:27015',
		'108.61.233.80:27015',
		'68.232.171.187:27155',
		'74.91.124.227:27021',
		'74.91.117.17:27015',
		'108.61.233.17:27025',
		'185.236.139.254:20001',
		'162.248.88.163:27027',
		'74.91.122.89:27015',
		'74.91.122.89:27025',
		'74.91.115.112:27015',
		'216.52.143.19:27015',
		'172.117.24.17:27015',
		'50.86.94.231:27015',
		'74.91.119.40:27015',
		'45.23.55.254:27015',
		'34.230.60.102:27015',
		'216.52.143.248:27015',
		'74.91.113.190:27015',
		'104.157.124.69:27014',
		'23.17.126.57:27045',
		'50.44.15.170:27015',
		'66.150.121.173:27015',
		'185.236.139.254:27043',
		'45.33.90.90:27015',
		'162.248.88.245:27015',
		'74.91.115.159:27055',
		'192.223.24.224:27015',
		'208.87.133.171:27016',
		'74.91.113.13:27015',
		'70.42.74.194:27055',
		'45.145.225.251:27017',
		'208.77.22.138:9002',
		'74.91.115.86:27015',
		'192.223.30.171:27015',
		'162.248.88.245:27016',
		'63.251.20.203:27015',
		'108.20.118.232:27015',
		'74.91.123.10:27015',
		'70.42.74.194:27057',
		'72.237.4.31:27015',
		'104.153.105.142:27015',
		'70.42.74.194:27015',
		'69.143.74.234:27015',
		'74.91.124.227:27020',
		'3.228.242.62:27015',
		'71.115.182.118:27028',
		'73.150.221.251:27015',
		'64.74.97.177:27015',
		'74.91.113.248:27215',
		'74.91.115.159:27051',
		'74.91.122.89:27018',
		'69.143.74.234:27017',
		'74.91.119.132:27015',
		'208.77.22.138:9000',
		'207.231.108.196:27015',
		'74.91.122.155:27015',
		'71.115.130.226:27017',
		'184.56.111.210:27015',
		'54.39.138.160:7777',
		'104.2.159.125:27015',
		'76.68.164.15:27015',
		'137.186.13.77:27017',
		'136.56.4.106:27025',
		'72.205.219.119:1134',
		'135.148.149.50:27015',
		'184.59.71.2:27025',
		'192.99.144.242:27017',
		'15.235.31.39:27015',
		'192.99.32.226:27015',
		'192.99.144.242:27015',
		'192.99.144.242:27016',
		'135.148.33.93:27015',
		'173.163.86.194:27015',
		'50.70.207.241:27015',
		'107.3.43.142:27015',
		'24.131.10.179:27016',
		'66.94.115.1:27015',
		'51.79.39.133:40003',
		'51.79.39.133:40002',
		'85.14.192.80:27015',
		'185.117.2.16:27015',
		'202.61.203.37:27715',
		'67.219.100.147:27015',
		'202.61.203.37:27615',
		'95.156.230.248:28015',
		'93.186.198.103:27315',
		'213.202.212.239:27055',
		'185.113.141.6:27504',
		'213.202.212.239:27120',
		'93.186.198.24:27515',
		'221.121.138.99:27017',
		'185.234.72.61:27070',
		'5.62.103.74:60200',
		'23.109.64.119:27015',
		'5.83.173.64:38400',
		'93.186.198.24:27215',
		'94.142.241.179:27017',
		'185.194.140.143:27015',
		'173.199.107.156:28020',
		'203.57.114.231:27017',
		'185.107.96.234:27015',
		'202.61.194.33:27045',
		'89.58.54.240:27015',
		'45.132.244.147:27035',
		'194.13.82.167:27015',
		'93.186.199.124:27415',
		'85.114.135.30:27036',
		'194.5.159.70:27015',
		'93.222.172.136:27060',
		'109.230.239.129:29060',
		'89.163.192.157:27015',
		'185.107.96.168:27015',
		'37.157.252.211:27015',
		'213.202.212.239:27105',
		'13.246.209.59:27017',
		'89.163.187.83:27015',
		'85.14.194.228:27015',
		'185.9.106.136:11770',
		'85.114.151.150:27015',
		'37.157.251.213:27015',
		'93.186.206.115:27016',
		'213.202.212.113:27019',
		'89.163.190.87:27015',
		'94.249.194.114:27030',
		'134.255.217.27:27755',
		'93.186.198.131:28115',
		'108.61.121.89:27015',
		'185.107.96.168:27017',
		'93.234.249.107:27015',
		'109.230.239.129:27175',
		'144.76.69.10:27333',
		'108.61.112.254:27065',
		'213.202.212.239:27065',
		'93.186.198.131:27115',
		'213.202.212.239:27027',
		'213.202.212.239:27075',
		'89.163.130.124:28000',
		'178.201.14.55:27015',
		'95.156.230.54:27915',
		'81.30.153.70:27015',
		'158.101.168.47:27016',
		'109.230.239.135:27030',
		'5.182.205.202:27016',
		'178.194.248.8:27015',
		'82.176.16.6:27015',
		'82.212.165.107:24014',
		'5.175.13.146:27055',
		'132.145.230.201:27015',
		'93.186.198.103:27055',
		'80.152.159.196:27015',
		'94.249.194.40:27030',
		'93.186.198.103:27010',
		'185.107.96.5:27015',
		'141.94.177.147:27017',
		'94.249.194.40:27060',
		'188.165.244.220:27050',
		'91.121.220.103:27080',
		'142.132.201.209:35000',
		'89.163.140.196:27023',
		'130.61.237.78:27016',
		'13.246.209.59:27015',
		'141.95.228.93:27016',
		'142.132.201.209:51300',
		'91.121.68.83:27050',
		'142.132.201.209:51050',
		'91.121.68.83:27026',
		'87.98.181.40:27015',
		'149.202.49.79:27015',
		'178.63.14.49:27015',
		'5.135.184.102:27015',
		'141.94.32.109:27015',
		'142.132.209.67:27016',
		'92.222.16.128:27015',
		'91.121.68.83:27035',
		'87.98.152.38:27016',
		'142.132.209.67:27015',
		'141.94.177.147:27015',
		'54.36.126.223:27069',
		'94.23.59.133:27016',
		'151.80.38.144:27015',
		'82.212.165.107:24012',
		'57.128.80.106:27015',
		'91.121.220.103:27070',
		'91.121.220.103:27040',
		'91.121.220.103:27030',
		'219.90.183.187:27215',
		'145.239.177.186:37015',
		'149.202.87.83:21315',
		'144.76.69.10:27015',
		'87.98.155.38:27017',
		'87.98.155.38:27016',
		'188.165.178.180:27017',
		'142.132.201.209:41000',
		'144.76.69.10:27019',
		'142.132.209.67:27017',
		'188.165.178.180:27019',
		'37.59.89.13:27015',
		'58.109.48.254:27016',
		'92.221.148.144:27016',
		'87.245.89.74:27018',
		'92.221.148.144:27015',
		'45.84.199.11:27015',
		'35.158.162.38:27015',
		'41.190.141.252:27015',
		'176.31.125.135:27016',
		'46.101.218.106:27015',
		'88.214.56.69:27220',
		'87.245.89.74:27035',
		'87.245.89.74:27015',
		'51.255.119.149:27015',
		'51.255.119.149:27016',
		'185.107.96.15:27015',
	] || await MasterServer({
		timeout: 5000,
		quantity: 1000,
		region: 'ANY',
		filter: new MasterServer.Filter()
			.appIds(215, 240, 17550, 17700) // some of these have bzip2
			// .appIds(10, 20, 30, 40, 50, 60, 70, 80, 130, 225840) // generally goldSource
			// .appIds(2400, 2401, 2402, 2403, 2405, 2406, 2410, 2412, 2413, 2420, 2430, 383790) // the ship
	});
	console.log(servers.length);
	debug(servers, 'servers');

	const results = await Promise.allSettled(servers.map(address => {
		return Server.getRules({
			ip: address,
			timeout: 30000,
		});
	}));

	console.log(results.filter(i => i.status === 'fulfilled').length);
	console.log(results.filter(i => i.status === 'rejected').length);

	classifyErrors(results, servers);

	setTimeout(() => {}, 5000);
})().catch(console.error);

